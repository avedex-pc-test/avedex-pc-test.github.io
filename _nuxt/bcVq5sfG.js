import{Q as t,v as e,r as a,eM as o,bG as n,bB as s,eN as u,a0 as i,eO as l,cj as r,eP as m,eQ as c,eR as d,eS as p,eT as h,eU as v,eV as f,eW as _,eX as k}from"./BY9EIVYr.js";import{a as y,b as w}from"./gfa7pY1Q.js";function b(){const b=t(),{t:T}=e(),S=a(!1);async function g(t,e){try{S.value=!0;await t.swapCallStatic();const a=t.swapInfo,o=(a.fromToken.isWrapper&&a.toToken.isETH||a.toToken.isWrapper&&a.fromToken.isETH,{from_address:a.fromToken.address,from_symbol:a.fromToken.symbol,from_amount:Number(f(a.fromTokenAmount||0,a.fromToken.decimals)),to_address:a.toToken.address,to_symbol:a.toToken.symbol,to_amount:Number(f(a.toTokenAmount||0,a.toToken.decimals)),chain:e,transaction:"",wallet_address:b.address});let s=null;t.swap().then((t=>(s=setTimeout((()=>{n({type:"success",message:T("transactionsSubmitted")})}),500),y({chain:e,destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:b.address,out_token:o.to_address,out_amount:Number(f(a.toTokenAmount||0,a.toToken.decimals)),in_token:o.from_address,in_amount:Number(f(a.fromTokenAmount||0,a.fromToken.decimals))}),S.value=!1,t.wait()))).then((t=>{var a,o;return s&&(clearTimeout(s),s=null),n({type:"success",message:T("tradeSuccess")}),w({chain:e,tx_hash:t.hash,status:100,to:(null==(o=null==(a=null==t?void 0:t.to)?void 0:a.toLowerCase)?void 0:o.call(a))||""}),t})).catch((t=>{S.value=!1,c(t,"swap")}))}catch(a){S.value=!1,c(a,"swap")}}return{walletSwap:async function(t,e){var a,x,A;if(!(null==(x=null==(a=Object.keys(o))?void 0:a.includes)?void 0:x.call(a,e.chain))&&"solana"!==e.chain)return void n({title:"Error",type:"error",message:T("noSupportChain",{chain:s(e.chain).name})});if(e.chain!==b.chain)return void n({title:"Error",type:"error",message:T("chainNotSame1")});S.value=!0;let M=await function(t){return k({tokenAddress:"solana"===t?"So11111111111111111111111111111111111111112":r,chain:t})}(e.chain).catch((()=>({balance:"0"})));if((null==M?void 0:M.balance)<t||0===Number(null==M?void 0:M.balance))return n({title:"Error",type:"error",message:T("insufficientBalance")}),void(S.value=!1);const F=e.chain,N=e.token,E=e.amm,O=null==E?void 0:E.includes("fourmeme");if(Number(t)>0){const a=s(F).decimals;if("solana"===F)return void async function(t,e){var a;const o=t.chain;if("solana"===o){S.value=!0;const o=await h(t.token);let s=!1;const l=!1,r=9,m=null==o?void 0:o.token_decimals,d={inputMint:"So11111111111111111111111111111111111111112",inputDecimals:r,inputMintSymbol:"SOL",inputMintName:"SOL",inputAmount:e||0,outputMint:t.token,outputDecimals:m,outputMintSymbol:o.token_symbol,outputMintName:o.token_symbol,amount:u((null==(a=new i(e||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${r}})?`)))?void 0:a[0])||0,r).toFixed(0),slippageBps:new i(30).times(100).toFixed(0),swapMode:"ExactIn",slippage:30,isPump:s,isMoonshot:l};S.value=!0;let p={};v(d).then((t=>{var e,a,o;let s="0";return t.routeInfo&&t.transaction?(p=t,s=(null==(o=null==(a=null==(e=t.routeInfo)?void 0:e.amountOut)?void 0:a.amount)?void 0:o.toFixed())||"0"):t.outAmount?(p=t,s=f(t.outAmount||"0",m)):c("can not get quote"),async function(t,e){try{S.value=!0;const a={from_address:e.inputMint,from_symbol:e.inputDecimals,from_amount:e.inputAmount,to_address:e.outputMint,to_symbol:e.outputDecimals,to_amount:e.toAmount,chain:"solana",transaction:"",wallet_address:b.address};let o=null;_(t).then((t=>(S.value=!1,o=setTimeout((()=>{n({type:"success",message:T("transactionsSubmitted")})}),500),y({chain:"solana",destination:"true"===localStorage.solanaProtection?"v1/blxrsol/sendSolTx":"/ave_nodes/rpc/solana/sendFastSwapTx",type:10,tx_hash:t.hash,status:1,wallet:b.address,out_token:a.to_address,out_amount:e.toAmount,in_token:a.from_address,in_amount:e.fromAmount}),t.wait()))).then((t=>{var e;return o&&(clearTimeout(o),o=null),n({type:"success",message:T("tradeSuccess")}),t&&w({chain:"solana",tx_hash:null==(e=null==t?void 0:t.transaction)?void 0:e.signatures[0],status:100}),t})).catch((t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:T("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:T("swapFail")}):c(t,"solana"),S.value=!1}))}catch(a){S.value=!1,c(a,"solana")}}(p,{...d,toAmount:s}),t})).catch((t=>(S.value=!1,c((null==t?void 0:t.error)||t),Promise.resolve(""))))}}(e,t);S.value=!0;const o={from_token:r,to_token:N,amountIn:u((null==(A=new i(t||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a}})?`)))?void 0:A[0])||0,a).toFixed(0),amountOut:"0"};if(O){try{const a=await l(o,F);m({fromAmount:u(t,18).toFixed(0),fromToken:{address:r,decimals:18,symbol:"BNB",amount:u(t,18).toFixed(0)},toToken:{address:e.token,decimals:18,symbol:"",amount:(null==a?void 0:a.amountOut)||"0"},isAmountOut:!1,quoteResult:{...a}},10).then((async t=>{g({...t,isFourMeme:!0},e.chain)})).catch((t=>{c(t)})),S.value=!1}catch(B){S.value=!1,c(B)}return}d(o,"",F).then((t=>{const e=t[0];p(e,30).then((async t=>{g(t,F)})).catch((t=>{c(t)}))})).catch((t=>{c(t)}))}},loadingWalletSwap:S}}export{b as u};
